Execute (VariablesPrinter: Parse Structured Variable):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
      \ '  v quoz, Foo, {class}:')
  AssertEqual {
      \ 'indentation': '  ',
      \ 'expanded': 1,
      \ 'unstructured': 0,
      \ 'name': 'quoz',
      \ 'type': 'Foo',
      \ 'presentation_hint': '{class}',
      \ 'value': '',
      \ }, g:parsed

Execute (VariablesPrinter: Parse Unstructured Variable):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
      \ '  - foo, int: 123')
  AssertEqual {
      \ 'indentation': '  ',
      \ 'expanded': 0,
      \ 'unstructured': 1,
      \ 'name': 'foo',
      \ 'type': 'int',
      \ 'presentation_hint': '',
      \ 'value': '123',
      \ }, g:parsed

Execute (VariablesPrinter: Parse Hinted Unstructured Variable):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
      \ '    - foo_, int, {property}: 456' )
  AssertEqual {
      \ 'indentation': '    ',
      \ 'expanded': 0,
      \ 'unstructured': 1,
      \ 'name': 'foo_',
      \ 'type': 'int',
      \ 'presentation_hint': '{property}',
      \ 'value': '456',
      \ }, g:parsed

Execute (VariablesPrinter: Parse Hinted Unstructured String Variable):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
    \ '    - bar_, string, {property}: "hello, world"')
  AssertEqual {
      \ 'indentation': '    ',
      \ 'expanded': 0,
      \ 'unstructured': 1,
      \ 'name': 'bar_',
      \ 'type': 'string',
      \ 'presentation_hint': '{property}',
      \ 'value': '"hello, world"',
      \ }, g:parsed

Execute (VariablesPrinter: Parse String Variable w/ Misinterpretable Contents):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
    \ '    - bar_, string: "{garble},:"')
  AssertEqual {
      \ 'indentation': '    ',
      \ 'expanded': 0,
      \ 'unstructured': 1,
      \ 'name': 'bar_',
      \ 'type': 'string',
      \ 'presentation_hint': '',
      \ 'value': '"{garble},:"',
      \ }, g:parsed

Execute (VariablesPrinter: Parse String Variable Holding The Line It's In):
  let g:parsed = dapper#view#VariablesPrinter#VariableFromString(
    \ '    - bar_, string: "    - bar_, string: "{garble},:""')
  AssertEqual {
      \ 'indentation': '    ',
      \ 'expanded': 0,
      \ 'unstructured': 1,
      \ 'name': 'bar_',
      \ 'type': 'string',
      \ 'presentation_hint': '',
      \ 'value': '"    - bar_, string: "{garble},:""',
      \ }, g:parsed

Execute (VariablesPrinter: Parse Bare Scope):
  let g:parsed = dapper#view#VariablesPrinter#ScopeFromString(
    \ '> Local :')
  AssertEqual {
      \ 'expanded': 0,
      \ 'name': 'Local',
      \ 'info': ''
      \ }, g:parsed

Execute (VariablesPrinter: Parse Scope w/ Info):
  let g:parsed = dapper#view#VariablesPrinter#ScopeFromString(
    \ '> Local : 5 named, 8 indexed')
  AssertEqual {
      \ 'expanded': 0,
      \ 'name': 'Local',
      \ 'info': '5 named, 8 indexed'
      \ }, g:parsed

Given (Buffer Contents):
  v Local : 5 named, 8 indexed
    - foo, int: 123
    - bar, float: 3.14
    v quoz, Foo, {class}:
      - foo_, int, {property}: 456
      - bar_, string, {property}: "hello, world"
  > Middle : 8 named, 8 indexed
  v Global : 5 named, 8 indexed
    - foo, int: 234
    - bar, float: 6.28
    v quoz, Foo, {class}:
      - foo_, int, {property}: 567
      - bar_, string, {property}: "goodbye, world"

Execute (VariablesPrinter: Set Up, Create Buffer, Printer Object):
  let g:var_lookup = {
      \ 'VariableFromPath': { -> 0 }
      \ }
  let g:buffer = typevim#Buffer#New({'bufnr': bufnr('%')})
  let g:vp = dapper#view#VariablesPrinter#New(
      \ g:dapper_middletalker, g:buffer, g:var_lookup)

Execute (VariablesPrinter: GetRange, Scope):
  call g:buffer.SetBuffer(bufnr('%'))
  let g:range = g:vp.GetRange(['Local'])
  AssertEqual [1, 6], g:range

  let g:range = g:vp.GetRange(['Middle'])
  AssertEqual [7, 7], g:range

  let g:range = g:vp.GetRange(['Global'])
  AssertEqual [8, 13], g:range

Execute (VariablesPrinter: GetRange, Scope That Doesn't Exist):
  call g:buffer.SetBuffer(bufnr('%'))
  AssertThrows call g:vp.GetRange(['ScopeyMcScopeface'])
  AssertNotEqual -1, match(g:vader_exception, 'ERROR(NotFound)'),
      \ 'Threw wrong exception: '.g:vader_exception

Execute (VariablesPrinter: GetRange, Unstructured Variable):
  call g:buffer.SetBuffer(bufnr('%'))
  let g:range = g:vp.GetRange(['Local', 'foo'])
  AssertEqual [2, 2], g:range

Execute (VariablesPrinter: GetRange, Nested Unstructured Variable):
  call g:buffer.SetBuffer(bufnr('%'))
  let g:range = g:vp.GetRange(['Global', 'foo'])
  AssertEqual [9, 9], g:range

Execute (VariablesPrinter: GetRange, Nested Structured Variable):
  call g:buffer.SetBuffer(bufnr('%'))
  let g:range = g:vp.GetRange(['Global', 'quoz', 'bar_'])
  AssertEqual [13, 13], g:range

Execute (VariablesPrinter: GetRange, Variable That Doesn't Exist):
  call g:buffer.SetBuffer(bufnr('%'))
  AssertThrows call g:vp.GetRange(['Middle', 'quoz', 'bar_'])
  AssertNotEqual -1, match(g:vader_exception, 'ERROR(NotFound)'),
      \ 'Threw wrong exception: '.g:vader_exception

Execute (VariablesPrinter: VarFromCursor, Scope @ Top of Buffer):
  call g:buffer.SetBuffer(bufnr('%'))
  normal! gg
  let g:path = g:vp.VarFromCursor(getcurpos(), 1)
  AssertEqual ['Local'], g:path

Execute (VariablesPrinter: VarFromCursor, Collapsed Scope in Middle of Buffer):
  call g:buffer.SetBuffer(bufnr('%'))
  call search('> Middle')
  let g:path = g:vp.VarFromCursor(getcurpos(), 1)
  AssertEqual ['Middle'], g:path

Execute (VariablesPrinter: VarFromCursor, Nested Variable @ Buffer Bottom):
  call g:buffer.SetBuffer(bufnr('%'))
  normal! G
  let g:path = g:vp.VarFromCursor(getcurpos(), 1)
  AssertEqual ['Global', 'quoz', 'bar_'], g:path

Execute (VariablesPrinter: VarFromCursor, "Top-Level" Variable):
  call g:buffer.SetBuffer(bufnr('%'))
  normal! 2G
  let g:path = g:vp.VarFromCursor(getcurpos(), 1)
  AssertEqual ['Local', 'foo'], g:path

Execute (VariablesPrinter: CollapseEntry, Local):
  call g:buffer.SetBuffer(bufnr('%'))
  let g:success = g:vp.CollapseEntry(['Local'])
  AssertEqual 1, g:success
Expect:
  > Local : 5 named, 8 indexed
  > Middle : 8 named, 8 indexed
  v Global : 5 named, 8 indexed
    - foo, int: 234
    - bar, float: 6.28
    v quoz, Foo, {class}:
      - foo_, int, {property}: 567
      - bar_, string, {property}: "goodbye, world"
